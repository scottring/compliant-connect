revoke delete on table "public"."companies" from "anon";

revoke insert on table "public"."companies" from "anon";

revoke references on table "public"."companies" from "anon";

revoke select on table "public"."companies" from "anon";

revoke trigger on table "public"."companies" from "anon";

revoke truncate on table "public"."companies" from "anon";

revoke update on table "public"."companies" from "anon";

revoke delete on table "public"."company_relationships" from "anon";

revoke insert on table "public"."company_relationships" from "anon";

revoke references on table "public"."company_relationships" from "anon";

revoke select on table "public"."company_relationships" from "anon";

revoke trigger on table "public"."company_relationships" from "anon";

revoke truncate on table "public"."company_relationships" from "anon";

revoke update on table "public"."company_relationships" from "anon";

revoke delete on table "public"."company_users" from "anon";

revoke insert on table "public"."company_users" from "anon";

revoke references on table "public"."company_users" from "anon";

revoke select on table "public"."company_users" from "anon";

revoke trigger on table "public"."company_users" from "anon";

revoke truncate on table "public"."company_users" from "anon";

revoke update on table "public"."company_users" from "anon";

revoke delete on table "public"."pir_requests" from "anon";

revoke insert on table "public"."pir_requests" from "anon";

revoke references on table "public"."pir_requests" from "anon";

revoke select on table "public"."pir_requests" from "anon";

revoke trigger on table "public"."pir_requests" from "anon";

revoke truncate on table "public"."pir_requests" from "anon";

revoke update on table "public"."pir_requests" from "anon";

revoke delete on table "public"."pir_responses" from "anon";

revoke insert on table "public"."pir_responses" from "anon";

revoke references on table "public"."pir_responses" from "anon";

revoke select on table "public"."pir_responses" from "anon";

revoke trigger on table "public"."pir_responses" from "anon";

revoke truncate on table "public"."pir_responses" from "anon";

revoke update on table "public"."pir_responses" from "anon";

revoke delete on table "public"."pir_tags" from "anon";

revoke insert on table "public"."pir_tags" from "anon";

revoke references on table "public"."pir_tags" from "anon";

revoke select on table "public"."pir_tags" from "anon";

revoke trigger on table "public"."pir_tags" from "anon";

revoke truncate on table "public"."pir_tags" from "anon";

revoke update on table "public"."pir_tags" from "anon";

revoke delete on table "public"."product_answer_history" from "anon";

revoke insert on table "public"."product_answer_history" from "anon";

revoke references on table "public"."product_answer_history" from "anon";

revoke select on table "public"."product_answer_history" from "anon";

revoke trigger on table "public"."product_answer_history" from "anon";

revoke truncate on table "public"."product_answer_history" from "anon";

revoke update on table "public"."product_answer_history" from "anon";

revoke delete on table "public"."product_answers" from "anon";

revoke insert on table "public"."product_answers" from "anon";

revoke references on table "public"."product_answers" from "anon";

revoke select on table "public"."product_answers" from "anon";

revoke trigger on table "public"."product_answers" from "anon";

revoke truncate on table "public"."product_answers" from "anon";

revoke update on table "public"."product_answers" from "anon";

revoke delete on table "public"."products" from "anon";

revoke insert on table "public"."products" from "anon";

revoke references on table "public"."products" from "anon";

revoke select on table "public"."products" from "anon";

revoke trigger on table "public"."products" from "anon";

revoke truncate on table "public"."products" from "anon";

revoke update on table "public"."products" from "anon";

revoke delete on table "public"."profiles" from "anon";

revoke insert on table "public"."profiles" from "anon";

revoke references on table "public"."profiles" from "anon";

revoke select on table "public"."profiles" from "anon";

revoke trigger on table "public"."profiles" from "anon";

revoke truncate on table "public"."profiles" from "anon";

revoke update on table "public"."profiles" from "anon";

revoke delete on table "public"."question_sections" from "anon";

revoke insert on table "public"."question_sections" from "anon";

revoke references on table "public"."question_sections" from "anon";

revoke select on table "public"."question_sections" from "anon";

revoke trigger on table "public"."question_sections" from "anon";

revoke truncate on table "public"."question_sections" from "anon";

revoke update on table "public"."question_sections" from "anon";

revoke delete on table "public"."question_tags" from "anon";

revoke insert on table "public"."question_tags" from "anon";

revoke references on table "public"."question_tags" from "anon";

revoke select on table "public"."question_tags" from "anon";

revoke trigger on table "public"."question_tags" from "anon";

revoke truncate on table "public"."question_tags" from "anon";

revoke update on table "public"."question_tags" from "anon";

revoke delete on table "public"."questions" from "anon";

revoke insert on table "public"."questions" from "anon";

revoke references on table "public"."questions" from "anon";

revoke select on table "public"."questions" from "anon";

revoke trigger on table "public"."questions" from "anon";

revoke truncate on table "public"."questions" from "anon";

revoke update on table "public"."questions" from "anon";

revoke delete on table "public"."response_comments" from "anon";

revoke insert on table "public"."response_comments" from "anon";

revoke references on table "public"."response_comments" from "anon";

revoke select on table "public"."response_comments" from "anon";

revoke trigger on table "public"."response_comments" from "anon";

revoke truncate on table "public"."response_comments" from "anon";

revoke update on table "public"."response_comments" from "anon";

revoke delete on table "public"."response_flags" from "anon";

revoke insert on table "public"."response_flags" from "anon";

revoke references on table "public"."response_flags" from "anon";

revoke select on table "public"."response_flags" from "anon";

revoke trigger on table "public"."response_flags" from "anon";

revoke truncate on table "public"."response_flags" from "anon";

revoke update on table "public"."response_flags" from "anon";

revoke delete on table "public"."tags" from "anon";

revoke insert on table "public"."tags" from "anon";

revoke references on table "public"."tags" from "anon";

revoke select on table "public"."tags" from "anon";

revoke trigger on table "public"."tags" from "anon";

revoke truncate on table "public"."tags" from "anon";

revoke update on table "public"."tags" from "anon";

create or replace view "public"."v_sections_hierarchy" as  WITH RECURSIVE section_hierarchy AS (
         SELECT question_sections.id,
            question_sections.name,
            question_sections.description,
            question_sections.order_index,
            question_sections.parent_id,
            question_sections.created_at,
            question_sections.updated_at,
            1 AS level,
            (question_sections.order_index)::text AS path_string,
            question_sections.name AS full_path_name
           FROM question_sections
          WHERE (question_sections.parent_id IS NULL)
        UNION ALL
         SELECT qs.id,
            qs.name,
            qs.description,
            qs.order_index,
            qs.parent_id,
            qs.created_at,
            qs.updated_at,
            (sh.level + 1),
            ((sh.path_string || '.'::text) || (qs.order_index)::text),
            ((sh.full_path_name || ' > '::text) || qs.name)
           FROM (question_sections qs
             JOIN section_hierarchy sh ON ((qs.parent_id = sh.id)))
        )
 SELECT section_hierarchy.id,
    section_hierarchy.name,
    section_hierarchy.description,
    section_hierarchy.order_index,
    section_hierarchy.parent_id,
    section_hierarchy.created_at,
    section_hierarchy.updated_at,
    section_hierarchy.level,
    section_hierarchy.path_string,
    section_hierarchy.full_path_name
   FROM section_hierarchy
  ORDER BY section_hierarchy.path_string;


create or replace view "public"."v_question_bank_numbered" as  WITH RECURSIVE section_hierarchy AS (
         SELECT question_sections.id,
            question_sections.name,
            question_sections.order_index,
            question_sections.parent_id,
            1 AS level,
            (question_sections.order_index)::text AS path_string
           FROM question_sections
          WHERE (question_sections.parent_id IS NULL)
        UNION ALL
         SELECT qs.id,
            qs.name,
            qs.order_index,
            qs.parent_id,
            (sh_1.level + 1),
            ((sh_1.path_string || '.'::text) || (qs.order_index)::text)
           FROM (question_sections qs
             JOIN section_hierarchy sh_1 ON ((qs.parent_id = sh_1.id)))
        )
 SELECT q.id AS question_id,
    q.text AS question_text,
    q.description AS question_description,
    q.type AS question_type,
    q.required AS question_required,
    q.options AS question_options,
    q.created_at AS question_created_at,
    q.updated_at AS question_updated_at,
    sh.id AS section_id,
    sh.name AS section_name,
        CASE
            WHEN (q.id IS NOT NULL) THEN ((sh.path_string || '.'::text) || (row_number() OVER (PARTITION BY sh.id ORDER BY q.order_index))::text)
            ELSE sh.path_string
        END AS hierarchical_number,
    sh.level AS section_level,
    COALESCE(q.order_index, 0) AS question_order_index
   FROM (section_hierarchy sh
     LEFT JOIN questions q ON ((q.section_id = sh.id)))
  ORDER BY sh.path_string, COALESCE(q.order_index, 0);



